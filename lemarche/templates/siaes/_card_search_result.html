{% load static m2m_list_display %}
{% load theme_inclusion %}

<div class="card c-card c-card--marche siae-card">
    <div class="row no-gutters">
        <div class="col-auto sc-img">
            <span class="p-3 d-inline-block">
                {% if siae.logo_url %}
                <img class="img-fluid" src="{{ siae.logo_url }}" alt="Logo de la structure {{ siae.name }}" />
                {% else %}
                <img class="img-fluid" src="{% static 'img/default-listing.png' %}" alt="{{ siae.name }}" />
                {% endif %}
            </span>
        </div>
        <div class="col">
            <div class="card-body">
                <a href="{% url 'siae:detail' siae.slug %}" class="text-decoration-none stretched-link">
                    <h3 class="mb-3 d-flex justify-content-between align-items-start">
                        {{ siae.name_display }}
                        {% if not siae.user_count %}
                            <small class="text-muted">(bientôt inscrite sur le marché)</small>
                        {% endif %}
                    </h3>
                    <ul class="list-unstyled m-0 lh-sm row no-gutters">
                        <li class="sc-profile-type col-12 col-lg-6 pr-lg-2 d-flex" title="Type(s) de prestation">
                            <img src="{% static_theme_images 'ico-briefcase-4-line.svg' %}" height="16" alt="" />
                            <span class="ml-1">{{ siae.presta_type_display }}</span>
                        </li>
                        {% if siae.sectors %}
                        <li class="sc-profile-sectors col-12 col-lg-6 pl-lg-2 mb-3 mb-lg-0 d-flex" title="Secteur(s) d'activité">
                            <img src="{% static_theme_images 'ico-service-line.svg' %}" height="16" alt="" />
                            <span class="ml-1">{% m2m_list_display siae 'sectors' 3 %}</span>
                        </li>
                        {% endif %}
                    </ul>
                    {% if user.is_authenticated %}
                        {% if siae.in_user_favorite_list_count %}
                        <a href="#" id="favorite-modal-btn" class="btn btn-favorite">
                            <img src="{% static_theme_images 'ico-star-fill.svg' %}" height="24" alt="Dans votre liste d'achat" title="Dans votre liste d'achat" />
                        </a>
                        {% else %}
                        <a href="#" id="favorite-modal-btn" class="btn btn-favorite" data-toggle="modal" data-target="#favorite_modal" data-siae-id="{{ siae.id }}" data-siae-slug="{{ siae.slug }}" data-siae-name-display="{{ siae.name_display }}">
                            <img src="{% static_theme_images 'ico-star-line.svg' %}" height="24" alt="Ajouter à votre liste d'achat" title="Ajouter à votre liste d'achat" />
                        </a>
                        {% endif %}
                    {% else %}
                        <a href="{% url 'auth:login' %}?message=login-to-favorite&next={% url 'siae:search_results' %}?{{ current_search_query_escaped }}" class="btn btn-favorite">
                            <img src="{% static_theme_images 'ico-star-line.svg' %}" height="24" alt="Ajouter à votre liste d'achat" title="Ajouter à votre liste d'achat" />
                        </a>
                    {% endif %}
                </a>
            </div>
        </div>
    </div>
    <div class="card-footer">
        <a href="{% url 'siae:detail' siae.slug %}" class="text-decoration-none stretched-link">
            <ul class="list-unstyled m-0 lh-sm fs-sm row no-gutters">
                <li class="sc-profile-town col-12 col-md-4 pr-lg-2 mb-3 mb-md-0 d-flex" title="Situé à {{ siae.city }}">
                    <img src="{% static_theme_images 'ico-map-pin-line.svg' %}" height="16" alt="" />
                    <span class="ml-1">{{ siae.city }}</span>
                </li>
                <li class="sc-profile-town-work col-12 col-md-4 px-lg-2 mb-3 mb-md-0 d-flex" title="Intervient sur : {{ siae.geo_range_pretty_title }}">
                    <img src="{% static_theme_images 'ico-compass-line.svg' %}" height="16" alt="" />
                    <span class="ml-1">{{ siae.geo_range_pretty_display }}</span>
                </li>
                {% if siae.kind %}
                    <li class="sc-profile-kind col-12 col-md-4 pl-lg-2 d-flex" title="Type de structure : {{ siae.get_kind_display }}">
                        <img src="{% static_theme_images 'ico-building-4-line.svg' %}" height="16" alt="" />
                        <span class="ml-1">{{ siae.get_kind_display }}</span>
                    </li>
                {% endif %}
            </ul>
        </a>
    </div>
</div>

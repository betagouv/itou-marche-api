{% extends BASE_TEMPLATE %}
{% load bootstrap4 static humanize%}

{% block title %}Suivi de l'impact{{ block.super }}{% endblock %}
{% block meta_description %}
<meta name="description" content="Identifier rapidement le nombre total de prestataires inclusifs pouvant répondre à votre besoin et mesurer leur capacité globale de production.">
{% endblock %}

{% block breadcrumbs %}
<section>
    <div class="container">
        <div class="row">
            <div class="col-12">
                <nav class="c-breadcrumb c-breadcrumb--marche" aria-label="breadcrumb">
                    <ol class="breadcrumb">
                        <li class="breadcrumb-item"><a href="{% url 'pages:home' %}">Accueil</a></li>
                        <li class="breadcrumb-item active" aria-current="page">Calculateur d'impact</li>
                    </ol>
                </nav>
            </div>
        </div>
    </div>
</section>
{% endblock %}

{% block content %}
<section class="s-page-menu-01 s-page-menu-01--marche has-illustration-bg-01">
    <div class="s-page-menu-01__container container">
        <div class="s-page-menu-01__row row align-items-center">
            <div class="s-page-menu-01__col s-page-menu-01__col--title col-12 col-lg-10">
                <h1 class="h1-hero">
                    <strong>Calculateur d'impact</strong>
                </h1>
                <p>Identifier rapidement le nombre total de prestataires inclusifs pouvant répondre à votre besoin et mesurer leur capacité globale de production.<p>
            </div>
        </div>
    </div>
</section>

<section class="pt-4 pb-6">
    <div class="container">
        <div class="row">
            <div class="col-12">

                {% block htmx %}
                <div id="calculatorImpact" class="row">
                    <div class="col-md-6 col-xs-12">
                        <form hx-post="./" hx-target="#calculatorImpact" hx-swap="outerHTML">
                            {% csrf_token %}
                            {% bootstrap_form_errors form type="all" %}
                            {% bootstrap_field form.sectors form_group_class="form-group use-multiselect" %}
                            <div class="form-group">
                                <label for="id_perimeters">{{ form.perimeters.label }}</label>
                                <div id="dir_form_perimeters" data-input-name="{{ form.perimeters.name }}"></div>
                                <div id="perimeters-selected" class="mt-2"></div>
                                {{ current_perimeters|json_script:"current-perimeters" }}
                            </div>
                            {% bootstrap_field form.presta_type %}

                            <button type="submit" class="btn btn-primary">
                                Calculer
                            </button>
                            {% if results %}
                                <button hx-get="./" class="btn" hx-target="#calculatorImpact" hx-swap="outerHTML">
                                    Recommencer
                                </button>
                            {% endif %}
                        </form>
                    </div>
                    <div class="col-md-6 col-xs-12">
                        {% if results %}
                        <h3>Résultats</h3>
                        <p>
                        Il y a <b>{{results.id__count}}</b> prestataires inclusifs positionnés sur les secteurs d’activités <i>{{results.sectors | join:", "}}</i>
                        pouvant intervenir sur {{results.perimeters |join:", " }}.
                        Ces <b>{{results.id__count}}</b> prestataires inclusifs représentent plus de <b>{{results.ca__sum|intcomma}}</b> € de chiffres d'affaires cumulé
                        et plus de <b>{{results.employees_insertion_count__sum|intcomma}}</b> salariés en insertion.
                        </p>
                        {% endif %}
                    </div>
                </div>

                {% endblock htmx %}

            </div>
        </div>
    </div>
</section>
{% endblock %}

{% block extra_js %}
<script type="text/javascript" src="{% static 'js/perimeters_autocomplete_fields.js' %}"></script>

{% endblock extra_js %}
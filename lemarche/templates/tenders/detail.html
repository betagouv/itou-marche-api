{% extends "layouts/base.html" %}
{% load bootstrap4 static humanize %}

{% block title %}{{ tender_kind_display }} {{ tender.title }}{{ block.super }}{% endblock %}

{% block breadcrumbs %}
<section>
    <div class="container">
        <div class="row">
            <div class="col-12">
                <nav class="c-breadcrumb c-breadcrumb--marche" aria-label="breadcrumb">
                    <ol class="breadcrumb">
                        <li class="breadcrumb-item"><a href="{% url 'wagtail_serve' '' %}">Accueil</a></li>
                        {% if user.is_authenticated %}
                            <li class="breadcrumb-item"><a href="{% url 'dashboard:home' %}">Tableau de bord</a></li>
                            <li class="breadcrumb-item"><a href="{% url 'tenders:list' %}">{{ parent_title }}</a></li>
                        {% endif %}
                        <li class="breadcrumb-item active" aria-current="page" title="{{ tender.title }}">{{ tender.title|truncatechars:25 }}</li>
                    </ol>
                </nav>
            </div>
        </div>
    </div>
</section>
{% endblock %}

{% block content %}
<section class="s-section">
    <div class="s-section__container container">
        <!-- Contact details above + help -->
        {% if not tender.deadline_date_outdated and not tender.response_is_anonymous %}
            {% if siae_has_detail_contact_click_date %}
                <div class="row">
                    <div class="col-12 col-lg-8">
                        <div class="alert alert-info fade show" role="status">
                            {% include "tenders/_detail_contact.html" with tender=tender source="alert" %}
                        </div>
                    </div>
                    <div class="col-12 col-lg-4">
                        <div class="alert alert-info mt-3 mt-lg-0" role="alert">
                            <p class="mb-1">
                                <i class="ri-information-line ri-lg"></i>
                                <strong>Conseil</strong>
                            </p>
                            <p class="mb-0 fs-sm">
                                N'attendez pas et contactez dÃ¨s maintenant le client.
                                En fonction, envoyez lui un devis, une plaquette commerciale ou rÃ©pondez Ã  son marchÃ©.
                            </p>
                        </div>
                    </div>
                </div>
            {% endif %}
        {% endif %}
        <div class="row">
            <!-- Main tender card -->
            <div class="col-12 col-lg-8 order-2">
                {% include "tenders/_detail_card.html" with tender=tender %}
            </div>
            <!-- Sidebar with actions -->
            <div class="col-12 col-lg-4 order-1 order-lg-2">
                {% include "tenders/_detail_sidebar.html" with tender=tender %}
            </div>
        </div>
    </div>
</section>
{% endblock %}

{% block modals %}
{% if not siae_has_detail_contact_click_date %}
    {% include "auth/_login_or_signup_siae_tender_modal.html" %}
{% endif %}
{% if not siae_has_detail_cocontracting_click_date %}
    {% include "tenders/_detail_contact_click_confirm_modal.html" %}
{% endif %}
{% if not siae_has_detail_not_interested_click_date %}
    {% include "tenders/_detail_not_interested_click_confirm_modal.html" %}
{% endif %}
{% endblock %}

{% block extra_js %}
{% if TALLY_NPS_FORM_ID and show_nps %}
    <script async type="text/javascript" src="https://tally.so/widgets/embed.js"></script>
    <script type="text/javascript">
        window.TallyConfig = {
            "formId": "{{ TALLY_NPS_FORM_ID }}",
            "popup": {
                "width": 400,
                "emoji": {
                    "text": "ðŸ‘‹",
                    "animation": "wave"
                },
                "open": {
                    "trigger": "time",
                    "ms": 2000
                },
                // "showOnce": true,  // show the popup only once to the same visitor (even if he didn't submit)
                "doNotShowAfterSubmit": true,  // after the visitor submits the form, don't show the popup again
                "autoClose": 0,  // automatically hide the popup after the form is submitted. optionally set a delay in seconds.
                "hideTitle": true,
                "layout": "modal"  // display in the center instead of bottom right corner
            },
        };
    </script>
{% endif %}
{% endblock %}
